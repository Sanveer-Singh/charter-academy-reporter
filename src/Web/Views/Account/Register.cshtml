@model Charter.Reporter.Web.Controllers.AccountController.RegisterVm
@{
    ViewData["Title"] = "Register";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
        <div class="card shadow mb-4 register-card">
            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">
                    <i class="fas fa-user-plus mr-2" aria-hidden="true"></i>
                    Register for Charter Reporter
                </h6>
            </div>
            <div class="card-body">
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-exclamation-triangle mr-2 mt-1" aria-hidden="true"></i>
                            <div>
                                <strong>Please fix the following issues:</strong>
                                <ul class="mb-0 mt-2">
                                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                                    {
                                        <li>@error.ErrorMessage</li>
                                    }
                                </ul>
                            </div>
                        </div>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                }

                <div class="mb-4">
                    <p class="text-muted mb-0">
                        <i class="fas fa-info-circle mr-2" aria-hidden="true"></i>
                        Create your account to access Charter Reporter dashboard and analytics.
                    </p>
                </div>
                
                <form asp-action="Register" method="post" id="registerForm" class="register-form" novalidate>
                    @Html.AntiForgeryToken()
                    
                    <!-- Personal Information -->
                    <div class="form-section mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-user mr-2" aria-hidden="true"></i>
                            Personal Information
                        </h6>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="FirstName" class="form-label">
                                    <i class="fas fa-user mr-1" aria-hidden="true"></i>
                                    First Name *
                                </label>
                                <input asp-for="FirstName" 
                                       class="form-control @(ViewData.ModelState["FirstName"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       placeholder="Enter your first name"
                                       autocomplete="given-name" />
                                <span asp-validation-for="FirstName" class="invalid-feedback d-block"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label asp-for="LastName" class="form-label">
                                    <i class="fas fa-user mr-1" aria-hidden="true"></i>
                                    Last Name *
                                </label>
                                <input asp-for="LastName" 
                                       class="form-control @(ViewData.ModelState["LastName"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       placeholder="Enter your last name"
                                       autocomplete="family-name" />
                                <span asp-validation-for="LastName" class="invalid-feedback d-block"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Email" class="form-label">
                                <i class="fas fa-envelope mr-1" aria-hidden="true"></i>
                                Email Address *
                            </label>
                            <input asp-for="Email" 
                                   class="form-control @(ViewData.ModelState["Email"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                   aria-required="true" 
                                   aria-describedby="email-help"
                                   placeholder="Enter your email address"
                                   autocomplete="email" />
                            <span asp-validation-for="Email" class="invalid-feedback d-block"></span>
                            <small id="email-help" class="form-text text-muted">
                                This will be your username and where we send important notifications.
                            </small>
                        </div>
                    </div>

                    <!-- Organization Information -->
                    <div class="form-section mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-building mr-2" aria-hidden="true"></i>
                            Organization Information
                        </h6>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="Organization" class="form-label">
                                    <i class="fas fa-building mr-1" aria-hidden="true"></i>
                                    Organization *
                                </label>
                                <input asp-for="Organization" 
                                       class="form-control @(ViewData.ModelState["Organization"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       placeholder="Enter your organization name"
                                       autocomplete="organization" />
                                <span asp-validation-for="Organization" class="invalid-feedback d-block"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label asp-for="Role" class="form-label">
                                    <i class="fas fa-user-tag mr-1" aria-hidden="true"></i>
                                    Requested Role *
                                </label>
                                <select asp-for="Role" 
                                        class="form-control @(ViewData.ModelState["Role"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                        aria-required="true"
                                        aria-describedby="role-help">
                                    <option value="">Select your role</option>
                                    <option value="CharterAdmin">Charter Admin</option>
                                    <option value="RebosaAdmin">REBOSA Admin</option>
                                    <option value="PpraAdmin">PPRA Admin</option>
                                </select>
                                <span asp-validation-for="Role" class="invalid-feedback d-block"></span>
                                <small id="role-help" class="form-text text-muted">
                                    Your role will be reviewed and approved by a Charter administrator.
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="form-section mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-address-card mr-2" aria-hidden="true"></i>
                            Contact Information
                        </h6>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="IdNumber" class="form-label">
                                    <i class="fas fa-id-card mr-1" aria-hidden="true"></i>
                                    ID Number *
                                </label>
                                <input asp-for="IdNumber" 
                                       class="form-control @(ViewData.ModelState["IdNumber"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       placeholder="Enter your ID number"
                                       maxlength="13" />
                                <span asp-validation-for="IdNumber" class="invalid-feedback d-block"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label asp-for="Cell" class="form-label">
                                    <i class="fas fa-mobile-alt mr-1" aria-hidden="true"></i>
                                    Cell Phone *
                                </label>
                                <input asp-for="Cell" 
                                       class="form-control @(ViewData.ModelState["Cell"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       placeholder="Enter your cell phone number"
                                       autocomplete="tel" />
                                <span asp-validation-for="Cell" class="invalid-feedback d-block"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Address" class="form-label">
                                <i class="fas fa-map-marker-alt mr-1" aria-hidden="true"></i>
                                Address *
                            </label>
                            <input asp-for="Address" 
                                   class="form-control @(ViewData.ModelState["Address"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                   aria-required="true"
                                   placeholder="Enter your address"
                                   autocomplete="street-address" />
                            <span asp-validation-for="Address" class="invalid-feedback d-block"></span>
                        </div>
                    </div>

                    <!-- Password Section -->
                    <div class="form-section mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-lock mr-2" aria-hidden="true"></i>
                            Account Security
                        </h6>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label asp-for="Password" class="form-label">
                                    <i class="fas fa-lock mr-1" aria-hidden="true"></i>
                                    Password *
                                </label>
                                <input asp-for="Password" 
                                       class="form-control @(ViewData.ModelState["Password"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       aria-describedby="password-help"
                                       placeholder="Create a secure password"
                                       autocomplete="new-password" />
                                <span asp-validation-for="Password" class="invalid-feedback d-block"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <label asp-for="ConfirmPassword" class="form-label">
                                    <i class="fas fa-lock mr-1" aria-hidden="true"></i>
                                    Confirm Password *
                                </label>
                                <input asp-for="ConfirmPassword" 
                                       class="form-control @(ViewData.ModelState["ConfirmPassword"]?.Errors.Any() == true ? "is-invalid" : "")" 
                                       aria-required="true"
                                       placeholder="Confirm your password"
                                       autocomplete="new-password" />
                                <span asp-validation-for="ConfirmPassword" class="invalid-feedback d-block"></span>
                            </div>
                        </div>
                        <small id="password-help" class="form-text text-muted">
                            <i class="fas fa-info-circle mr-1" aria-hidden="true"></i>
                            Password must be at least 8 characters long and include uppercase, lowercase, number, and special character.
                        </small>
                    </div>
                    
                    <div class="form-group mb-4">
                        <button type="submit" class="btn btn-primary btn-lg btn-block" id="registerButton">
                            <span class="button-text">
                                <i class="fas fa-user-plus mr-2" aria-hidden="true"></i>
                                Create Account
                            </span>
                            <span class="button-loading d-none">
                                <i class="fas fa-spinner fa-spin mr-2" aria-hidden="true"></i>
                                Creating Account...
                            </span>
                        </button>
                    </div>
                    
                    <div class="text-center">
                        <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center">
                            <a class="btn btn-link" asp-controller="Account" asp-action="Login">
                                <i class="fas fa-sign-in-alt mr-1" aria-hidden="true"></i>
                                Already have an account? Sign in here
                            </a>
                        </div>
                        <small class="text-muted mt-2">
                            Need help? Contact us at 
                            <a href="mailto:support@charter.co.za" class="text-decoration-none">support@charter.co.za</a>
                        </small>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registerForm');
            const button = document.getElementById('registerButton');
            const buttonText = button.querySelector('.button-text');
            const buttonLoading = button.querySelector('.button-loading');
            
            form.addEventListener('submit', function(e) {
                // Allow the form to submit first, then show loading state after a brief delay
                setTimeout(function() {
                    // Show loading state
                    button.disabled = true;
                    buttonText.classList.add('d-none');
                    buttonLoading.classList.remove('d-none');
                    
                    // Disable form inputs (but don't disable the submit button since form is already submitting)
                    const inputs = form.querySelectorAll('input:not([type="submit"]), select');
                    inputs.forEach(input => input.disabled = true);
                }, 100); // Small delay to allow form submission to start
                
                // Re-enable after timeout in case of server error
                setTimeout(function() {
                    if (button.disabled) {
                        button.disabled = false;
                        buttonText.classList.remove('d-none');
                        buttonLoading.classList.add('d-none');
                        const inputs = form.querySelectorAll('input, select');
                        inputs.forEach(input => input.disabled = false);
                    }
                }, 15000); // 15 second timeout for registration
            });
            
            // Focus management for accessibility
            const firstErrorField = form.querySelector('.is-invalid');
            if (firstErrorField) {
                firstErrorField.focus();
            }

            // Password confirmation validation
            const passwordField = document.querySelector('input[name="Password"]');
            const confirmPasswordField = document.querySelector('input[name="ConfirmPassword"]');
            
            function validatePasswordMatch() {
                if (confirmPasswordField.value && passwordField.value !== confirmPasswordField.value) {
                    confirmPasswordField.setCustomValidity('Passwords do not match');
                    confirmPasswordField.classList.add('is-invalid');
                } else {
                    confirmPasswordField.setCustomValidity('');
                    confirmPasswordField.classList.remove('is-invalid');
                }
            }

            passwordField?.addEventListener('input', validatePasswordMatch);
            confirmPasswordField?.addEventListener('input', validatePasswordMatch);
        });
    </script>
    

}


